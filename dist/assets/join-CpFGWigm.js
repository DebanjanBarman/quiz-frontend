import{_ as F,a as W,b as J,c as K,d as Q,e as H,V as X}from"./AppBar-DM9jA0lH.js";import{a as g,b as f}from"./index-BA41vzv-.js";import{q as Y,s as Z,r as l,o as tt,b as r,c as _,d as s,w as o,u as a,v as et,e as V,f as u,F as at,i as n,t as y,j as C}from"./index-DvVByYbY.js";import{l as ot}from"./index-NsU1tN7b.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as lt}from"./VSnackbar-DUJBTM5Q.js";import{V as z}from"./VContainer-B08sewyi.js";import{V as G}from"./forwardRefs-De2f303C.js";import{V as D}from"./VCardTitle-BBBAXpNz.js";import{V as rt}from"./VRow-DS5sCb_f.js";import{V as h}from"./VChip-SfnXZfh0.js";import{V as j}from"./VDataTable-CwaYPw7s.js";import"./filter-H5zZRxq7.js";import"./VTextField-CW32dwfx.js";import"./VInput-CYM8uH9X.js";import"./VSelectionControl-ClCvZmCB.js";const nt={class:"px-4 mb-8"},it={key:0},ut={key:1},ct={key:2},dt={key:3},mt={key:4},pt={key:5},gt={__name:"join",setup(ft){const c=Y(),d=Z().params.id,$=l(""),M=l("primary"),v=l(!1),x=l([]),E=l([]),m=l(""),i=l({}),I=l(!0),O=l(!1),N=l(!1),S=l(!1),b=ot(g.baseURL),q=l(!1);b.on("connect",()=>{console.log(b.id)});async function T(){try{let t=(await f.get(`${g.result}/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).data.data,w=[];for(const k in t){let p={};p.name=t[k].name,p.email=t[k].email,p.score=t[k].score,p.incorrect_answers=t[k].incorrect_answers,p.time_taken=(t[k].time_taken/1e3).toFixed(2),p.time_taken<0&&(p.time_taken="NA"),w.push(p)}x.value=w}catch(e){console.log(e),e.status===401&&(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login"))}}async function L(){try{let t=(await f.get(`${g.quizzesURL}/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).data.quiz;i.value=t,m.value=t.status.toLowerCase(),console.log(m.value)}catch(e){console.log(e),e.status===401?(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login")):(console.log(e),await c.push("/"))}}async function P(){try{const e={user_id:localStorage.getItem("userId"),quiz_id:d,user_name:localStorage.getItem("name"),user_email:localStorage.getItem("email")};console.log(e);const t=await f.post(`${g.join_game}`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});console.log(t.data),v.value=!0,$.value="Request sent to the admin",$.color="secondary",I.value=!1}catch(e){console.log(e),e.status===401?(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login")):console.log(e)}}async function A(){try{let t=(await f.get(`${g.result}/accepted-users/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).data.data;E.value=t,console.log(t)}catch(e){console.log(e),e.status===401&&(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login"))}}async function R(){try{(await f.get(`${g.join_request_sent}/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).status===200&&(I.value=!1)}catch(e){e.status===401&&(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login"))}}async function U(){try{const e=await f.get(`${g.response}/eligible/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});S.value=!0,console.log(e.data.data)}catch(e){console.log(e.status),e.status===401?(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login")):e.status===400&&(O.value=!0,S.value=!1)}}async function B(){try{const e=await f.get(`${g.response}/check/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});q.value=e.data.data.ended,e.status===200&&(N.value=!0)}catch(e){console.log(e.status),e.status===401?(console.log("NOT LOGGED IN"),localStorage.clear(),await c.push("/login")):e.status===400&&(O.value=!0)}}return b.on("quiz_updated",async e=>{console.log(e),await L(),await T(),await A(),await R(),await U(),await B()}),tt(async()=>{await L(),await T(),await A(),await R(),await U(),await B()}),(e,t)=>(r(),_(at,null,[s(F),s(lt,{modelValue:a(v),"onUpdate:modelValue":t[1]||(t[1]=w=>et(v)?v.value=w:null),color:a(M),timeout:"3000"},{actions:o(()=>[s(G,{variant:"text",onClick:t[0]||(t[0]=w=>v.value=!1)},{default:o(()=>t[3]||(t[3]=[n(" Close ")])),_:1})]),default:o(()=>[n(y(a($))+" ",1)]),_:1},8,["modelValue","color"]),a(m).toUpperCase()==="WAITING"||a(m).toUpperCase()==="COMPLETED"||a(m).toUpperCase()==="LIVE"?(r(),V(z,{key:0,class:"main-section"},{default:o(()=>[s(X,null,{default:o(()=>[s(W,{height:"250",src:a(i).thumbnail,cover:""},null,8,["src"]),s(J,null,{default:o(()=>[s(D,null,{default:o(()=>[n(y(a(i).title),1)]),_:1})]),_:1}),s(K,null,{default:o(()=>[C("div",null,y(a(i).description),1)]),_:1}),s(Q,{class:"mx-4 mb-1"}),s(D,null,{default:o(()=>t[4]||(t[4]=[n("Status")])),_:1}),C("div",nt,[s(rt,{class:"mt-2"},{default:o(()=>[a(i).status.toUpperCase()==="WAITING"?(r(),_("div",it,[s(h,{color:"orange",class:"ml-3"},{default:o(()=>[n(y(a(i).status.toUpperCase()),1)]),_:1})])):u("",!0),a(i).status.toUpperCase()==="LIVE"?(r(),_("div",ut,[s(h,{color:"green",class:"ml-3"},{default:o(()=>[n(y(a(i).status.toUpperCase()),1)]),_:1})])):u("",!0),a(i).status.toUpperCase()==="COMPLETED"?(r(),_("div",ct,[s(h,{color:"red",class:"ml-3"},{default:o(()=>[n(y(a(i).status.toUpperCase()),1)]),_:1})])):u("",!0),!a(I)&&!a(N)?(r(),_("div",dt,[s(h,{color:"blue",class:"ml-3"},{default:o(()=>t[5]||(t[5]=[n("Join Request sent")])),_:1})])):u("",!0),a(N)&&!a(q)?(r(),_("div",mt,[s(h,{color:"blue",class:"ml-3"},{default:o(()=>t[6]||(t[6]=[n("Join Request Accepted")])),_:1})])):u("",!0),a(q)?(r(),_("div",pt,[s(h,{color:"blue",class:"ml-3"},{default:o(()=>t[7]||(t[7]=[n("Participated")])),_:1})])):u("",!0)]),_:1})]),s(H,null,{default:o(()=>[a(I)&&a(i).status.toUpperCase()==="WAITING"?(r(),V(G,{key:0,variant:"outlined",color:"deep-purple-lighten-2",block:"",style:{"margin-bottom":"1rem"},onMousedown:P},{default:o(()=>t[8]||(t[8]=[n(" Request to join ")])),_:1})):u("",!0),a(S)?(r(),V(G,{key:1,variant:"outlined",color:"green",block:"",style:{"margin-bottom":"1rem"},onMousedown:t[2]||(t[2]=w=>a(c).push(`/quiz/${a(d)}`))},{default:o(()=>t[9]||(t[9]=[n(" Start ")])),_:1})):u("",!0)]),_:1})]),_:1})]),_:1})):u("",!0),a(m)==="completed"||a(m)==="live"?(r(),V(z,{key:1},{default:o(()=>[t[10]||(t[10]=C("h3",{style:{"max-width":"50rem",margin:"auto auto 1rem"}}," Leaderboard ",-1)),s(j,{items:a(x),style:{"max-width":"50rem",margin:"auto auto 1rem"}},null,8,["items"])]),_:1})):u("",!0),a(m)==="waiting"?(r(),V(z,{key:2},{default:o(()=>[t[11]||(t[11]=C("h3",{style:{"max-width":"40rem",margin:"auto auto 1rem"}},"Participants",-1)),s(j,{items:a(E),style:{"max-width":"40rem",margin:"auto"}},null,8,["items"])]),_:1})):u("",!0)],64))}},Et=st(gt,[["__scopeId","data-v-881f5267"]]);export{Et as default};
